colnames(fig3b) <- c('MDEM', 'Freq')
fig3b$agg <- c(1:5, rep(0,23))
fig3b_top5 <- data.frame(c('Other',as.vector(fig3b$MDEM[1:5])), aggregate(Freq ~ agg, data=fig3b, FUN=sum))
colnames(fig3b_top5) <- c('MDEM', 'agg', 'Freq')
#fig3b_top5$MDEM <- gsub(' syndrome','',fig3b_top5$MDEM)
fig3b_top5$MDEM <- c('Other','KS1','WSS','SS','ATS','MRD1')
#pdf(file='CWG_Fig3.pdf')
fig3b_plot <- ggplot(fig3b_top5, aes(x="", y=Freq,
fill=factor(MDEM, levels=c('KS1',
'WSS',
'SS',
'ATS',
'MRD1',
'Other')))) +
ggtitle('b') +
geom_bar(stat="identity", width=1, color="white") +
geom_text(aes(label = paste0(Freq, '\n', round(Freq / sum(Freq) * 100, 1),"%"), x = 1.65),
position = position_stack(vjust = 0.5),
size=3.5,
color='black') +
scale_fill_manual(values=c('#C31407','#609FFF','#F9DE46','#A234F3','#FF9500','#A0E9F9')) +
labs(fill='MDEM') +
coord_polar("y", start=0) +
theme_void() +
theme(legend.text = element_text(size=11),
legend.title = element_text(size=12),
legend.key.height= unit(0.5, 'cm'),
legend.key.width= unit(0.5, 'cm'))
g3a <- ggplotGrob(fig3a_plot)
g3b <- ggplotGrob(fig3b_plot)
g <- rbind(g3a, g3b, size='first')
g$widths <- unit.pmax(g3a$widths, g3b$widths)
grid.newpage()
grid.draw(g)
ggsave(g, file="fig3.eps", device="eps", width=7.5, height=10, dpi=600)
fig1a_YearNum$VisitType
fig1a_YearNum$VisitType <- gsub('followup','follow-up',fig1a_YearNum$VisitType)
fig1a_YearNum
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
theme_minimal(base_size = 17) +
theme(plot.title = element_text(hjust=-0.15, vjust=3)) +
scale_fill_manual(values=c('#609FFF','#609FFF','#C31407','#C31407')) +
geom_col_pattern(pattern=c('none','none',
'none','none',
'none','none',
'none','none','stripe','stripe',
'none','none','stripe','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.02,
pattern_density=.2) +
geom_text(aes(label = paste0(Freq,' (',YearPct,'%)')),
position = position_stack(vjust = 0.5),
size=3.5,
color='white',
fontface='bold') +
labs(fill='Visit type') +
xlab('Year number') +
ylab('Frequency') +
guides(fill=guide_legend(reverse=TRUE,
override.aes =
list(
pattern=c('none','stripe','none','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig1_plot, file="fig1.eps", device="eps", width=7.5, height=8, dpi=600)
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
theme_minimal(base_size = 17) +
theme_classic()
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
theme_minimal(base_size = 17) +
theme_classic() +
theme(plot.title = element_text(hjust=-0.15, vjust=3)) +
scale_fill_manual(values=c('#609FFF','#609FFF','#C31407','#C31407')) +
geom_col_pattern(pattern=c('none','none',
'none','none',
'none','none',
'none','none','stripe','stripe',
'none','none','stripe','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.02,
pattern_density=.2) +
geom_text(aes(label = paste0(Freq,' (',YearPct,'%)')),
position = position_stack(vjust = 0.5),
size=3.5,
color='white',
fontface='bold') +
labs(fill='Visit type') +
xlab('Year number') +
ylab('Frequency') +
guides(fill=guide_legend(reverse=TRUE,
override.aes =
list(
pattern=c('none','stripe','none','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig1_plot, file="fig1.eps", device="eps", width=7.5, height=8, dpi=600)
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
theme_minimal(base_size = 17) +
theme_classic(base_size = 17) +
theme(plot.title = element_text(hjust=-0.15, vjust=3)) +
scale_fill_manual(values=c('#609FFF','#609FFF','#C31407','#C31407')) +
geom_col_pattern(pattern=c('none','none',
'none','none',
'none','none',
'none','none','stripe','stripe',
'none','none','stripe','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.02,
pattern_density=.2) +
geom_text(aes(label = paste0(Freq,' (',YearPct,'%)')),
position = position_stack(vjust = 0.5),
size=3.5,
color='white',
fontface='bold') +
labs(fill='Visit type') +
xlab('Year number') +
ylab('Frequency') +
guides(fill=guide_legend(reverse=TRUE,
override.aes =
list(
pattern=c('none','stripe','none','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig1_plot, file="fig1.eps", device="eps", width=7.5, height=8, dpi=600)
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
theme_minimal(base_size = 17) +
theme_classic(base_size = 17) +
theme(plot.title = element_text(hjust=-0.15, vjust=3)) +
ylim(0,250) +
scale_fill_manual(values=c('#609FFF','#609FFF','#C31407','#C31407')) +
geom_col_pattern(pattern=c('none','none',
'none','none',
'none','none',
'none','none','stripe','stripe',
'none','none','stripe','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.02,
pattern_density=.2) +
geom_text(aes(label = paste0(Freq,' (',YearPct,'%)')),
position = position_stack(vjust = 0.5),
size=3.5,
color='white',
fontface='bold') +
labs(fill='Visit type') +
xlab('Year number') +
ylab('Frequency') +
guides(fill=guide_legend(reverse=TRUE,
override.aes =
list(
pattern=c('none','stripe','none','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig1_plot, file="fig1.eps", device="eps", width=7.5, height=8, dpi=600)
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
theme_minimal(base_size = 17) +
theme_classic(base_size = 17) +
theme(plot.title = element_text(hjust=-0.15, vjust=3)) +
scale_y_continuous(expand = expansion(mult = c(0, 50))) +
scale_fill_manual(values=c('#609FFF','#609FFF','#C31407','#C31407')) +
geom_col_pattern(pattern=c('none','none',
'none','none',
'none','none',
'none','none','stripe','stripe',
'none','none','stripe','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.02,
pattern_density=.2) +
geom_text(aes(label = paste0(Freq,' (',YearPct,'%)')),
position = position_stack(vjust = 0.5),
size=3.5,
color='white',
fontface='bold') +
labs(fill='Visit type') +
xlab('Year number') +
ylab('Frequency') +
guides(fill=guide_legend(reverse=TRUE,
override.aes =
list(
pattern=c('none','stripe','none','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig1_plot, file="fig1.eps", device="eps", width=7.5, height=8, dpi=600)
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
theme_minimal(base_size = 17) +
theme_classic(base_size = 17) +
theme(plot.title = element_text(hjust=-0.15, vjust=3)) +
scale_y_continuous(expand = expansion(mult = c(0, 0))) +
scale_fill_manual(values=c('#609FFF','#609FFF','#C31407','#C31407')) +
geom_col_pattern(pattern=c('none','none',
'none','none',
'none','none',
'none','none','stripe','stripe',
'none','none','stripe','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.02,
pattern_density=.2) +
geom_text(aes(label = paste0(Freq,' (',YearPct,'%)')),
position = position_stack(vjust = 0.5),
size=3.5,
color='white',
fontface='bold') +
labs(fill='Visit type') +
xlab('Year number') +
ylab('Frequency') +
guides(fill=guide_legend(reverse=TRUE,
override.aes =
list(
pattern=c('none','stripe','none','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig1_plot, file="fig1.eps", device="eps", width=7.5, height=8, dpi=600)
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
theme_minimal(base_size = 17) +
theme_classic(base_size = 17) +
theme(plot.title = element_text(hjust=-0.15, vjust=3)) +
scale_y_continuous(expand = expansion(mult = c(0, 250))) +
scale_fill_manual(values=c('#609FFF','#609FFF','#C31407','#C31407')) +
geom_col_pattern(pattern=c('none','none',
'none','none',
'none','none',
'none','none','stripe','stripe',
'none','none','stripe','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.02,
pattern_density=.2) +
geom_text(aes(label = paste0(Freq,' (',YearPct,'%)')),
position = position_stack(vjust = 0.5),
size=3.5,
color='white',
fontface='bold') +
labs(fill='Visit type') +
xlab('Year number') +
ylab('Frequency') +
guides(fill=guide_legend(reverse=TRUE,
override.aes =
list(
pattern=c('none','stripe','none','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig1_plot, file="fig1.eps", device="eps", width=7.5, height=8, dpi=600)
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
theme_minimal(base_size = 17) +
theme_classic(base_size = 17) +
theme(plot.title = element_text(hjust=-0.15, vjust=3)) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
scale_fill_manual(values=c('#609FFF','#609FFF','#C31407','#C31407')) +
geom_col_pattern(pattern=c('none','none',
'none','none',
'none','none',
'none','none','stripe','stripe',
'none','none','stripe','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.02,
pattern_density=.2) +
geom_text(aes(label = paste0(Freq,' (',YearPct,'%)')),
position = position_stack(vjust = 0.5),
size=3.5,
color='white',
fontface='bold') +
labs(fill='Visit type') +
xlab('Year number') +
ylab('Frequency') +
guides(fill=guide_legend(reverse=TRUE,
override.aes =
list(
pattern=c('none','stripe','none','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig1_plot, file="fig1.eps", device="eps", width=7.5, height=8, dpi=600)
#pdf(file='CWG_Fig1.pdf')
fig1_plot <- ggplot(data=fig1a_YearNum, aes(x=YearNum, y=Freq, fill=factor(VisitType, levels=c('video return','follow-up','video new','new')))) +
#ggtitle('1') +
geom_bar(stat='identity') +
#theme_minimal(base_size = 17) +
theme_classic(base_size = 17) +
theme(plot.title = element_text(hjust=-0.15, vjust=3)) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
scale_fill_manual(values=c('#609FFF','#609FFF','#C31407','#C31407')) +
geom_col_pattern(pattern=c('none','none',
'none','none',
'none','none',
'none','none','stripe','stripe',
'none','none','stripe','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.02,
pattern_density=.2) +
geom_text(aes(label = paste0(Freq,' (',YearPct,'%)')),
position = position_stack(vjust = 0.5),
size=3.5,
color='white',
fontface='bold') +
labs(fill='Visit type') +
xlab('Year number') +
ylab('Frequency') +
guides(fill=guide_legend(reverse=TRUE,
override.aes =
list(
pattern=c('none','stripe','none','stripe'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig1_plot, file="fig1.eps", device="eps", width=7.5, height=8, dpi=600)
fig6_plot <- ggplot(fig6, aes(x="", y=Freq,
fill=factor(EM, levels=c('Writer',
'Writer, dual',
'Eraser',
'Eraser, dual',
'Reader',
'Remodeler, dual',
'Etiology unknown')))) +
#ggtitle('6') +
coord_polar("y", start=0) +
geom_bar(stat="identity") +
geom_col_pattern(pattern=c('none', 'none', 'circle', 'none', 'circle', 'none', 'circle'),
pattern_fill='black',
pattern_colour=NA,
pattern_size=.5,
pattern_spacing=.02,
pattern_density=.2,
color='white') +
geom_text(aes(label = paste0(Freq, '\n', round(Freq / sum(Freq) * 100, 1),"%"), x = 1.55),
position = position_stack(vjust = 0.5),
size=3.5,
color='black') +
scale_fill_manual(values=c('#C31407','#C31407','#609FFF','#609FFF','#F9DE46','#FF9500','#A234F3')) +
labs(fill='EM component') +
theme_void() +
theme(legend.text = element_text(size=11),
legend.title = element_text(size=12),
legend.key.height= unit(0.5, 'cm'),
legend.key.width= unit(0.5, 'cm')) +
guides(fill=guide_legend(reverse=FALSE,
override.aes =
list(
pattern=c('none', 'circle', 'none', 'circle', 'none', 'circle', 'none'),
pattern_fill='black',
pattern_colour='black',
pattern_size=.1,
pattern_spacing=.015,
pattern_density=.2
)))
ggsave(fig6_plot, file="fig6.eps", device="eps", width=8, height=8, dpi=600)
70/112
115+36+2+139
292/432
setwd("~/Desktop/temp/Fahrner lab/Data/Weaver/fahrner_weaver/RNAseq/final_analysis")
### BEGIN CHRISTINE'S IMPORT
samples <- read.csv('RNAseq-samples.csv')
dir <- '~/Desktop/temp/Fahrner lab/Data/Weaver/fahrner_weaver/RNAseq/final_analysis/quants_final'
files <- file.path(dir, paste(samples$Sample.ID, '_quant', sep=''), 'quant.sf')
files
file.exists(files)
coldata <- data.frame(files, names=samples$Sample.ID, condition=samples$Genotype, stringsAsFactors = FALSE)
coldata
# import transcript abundances
se <- tximeta(coldata)
library(TxDb.Mmusculus.UCSC.mm10.ensGene)
library(tximport)
library(DESeq2)
library(sva)
library(biomaRt)
library(ggplot2)
library(ggrepel)
library(tximeta)
library(SummarizedExperiment)
library(edgeR)
library(limma)
library(statmod)
library(tidyverse)
# import transcript abundances
se <- tximeta(coldata)
# summarize abundances to gene level
gse <- summarizeToGene(se)
# load SummarizedExperiment into DESeqDataSet
dds <- DESeqDataSet(gse, design=~condition)
dds$condition
### BEGIN CHRISTINE'S ANALYSIS
dds$condition <- relevel(dds$condition, ref="WT")
plot <- plotPCA(vst(dds))
plot + geom_label_repel(aes(label=gsub("-.*", "", colnames(dds))), show.legend = FALSE)
# collapse technical replicates
dds$sample <- factor(gsub("-.*", "", colnames(dds)))
dds$sample
dds.coll <- collapseReplicates(dds, dds$sample)
dds.coll
assay(dds.coll)
stopifnot(all(rowSums(counts(dds[,which(dds$sample=="705")])) == counts(dds.coll[,1])))
dds.coll.counts <- counts(dds.coll)
# filter genes with low median counts
keep <- rowMedians(counts(dds.coll)) > 10
dds.coll.filtered <- dds.coll[keep,]
#dds.coll.filtered$condition <- relevel(dds.coll.filtered$condition, ref="WT")
plot <- plotPCA(vst(dds.coll.filtered))
plot + geom_label_repel(aes(label=gsub("-.*", "", colnames(dds.coll.filtered))), show.legend = FALSE)
# find surrogate variables for batch effects using sva
dds.coll.filtered.counts <- counts(dds.coll.filtered)
mod <- model.matrix(~condition, colData(dds.coll.filtered))
mod0 <- model.matrix(~1, colData(dds.coll.filtered))
svseq <- svaseq(dds.coll.filtered.counts, mod, mod0)
# append surrogate variables
ddssva <- dds.coll.filtered
ddssva$SV1 <- svseq$sv[,1]
ddssva$SV2 <- svseq$sv[,2]
# ddssva$SV3 <- svseq$sv[,3]
# design(ddssva) <- formula(~SV1 + SV2 + SV3 + condition)
design(ddssva) <- formula(~SV1 + SV2 + condition)
# DESeq2 call
ddssva <- DESeq(ddssva)
dds <- ddssva
save(dds, file='dds_final.rda')
res <- results(dds)
diffexp.subset <- as.data.frame(res[which(res$padj <0.1),])
# gene annotation - CWG
ensembl.id <- rownames(diffexp.subset)
ensembl102.mmusculus <- useEnsembl(biomart='genes', dataset='mmusculus_gene_ensembl', version=102)
mgi <- getBM(attributes=c('ensembl_gene_id','mgi_symbol','mgi_description'),
filters='ensembl_gene_id',
values=ensembl.id,
mart=ensembl102.mmusculus)
diffexp.subset$ensembl_gene_id <- ensembl.id
diffexp.subset <- merge(diffexp.subset, mgi, by='ensembl_gene_id')
diffexp.subset <- diffexp.subset[order(diffexp.subset$log2FoldChange, decreasing=TRUE),]
write.csv(diffexp.subset, file="diffexp_final.csv")
res
hist(res$pvalue)
hist(res$pvalue)
dev.off()
dev.off()
hist(res$pvalue)
#dds.coll.filtered$condition <- relevel(dds.coll.filtered$condition, ref="WT")
plot <- plotPCA(vst(dds.coll.filtered))
plot + geom_label_repel(aes(label=gsub("-.*", "", colnames(dds.coll.filtered))), show.legend = FALSE)
